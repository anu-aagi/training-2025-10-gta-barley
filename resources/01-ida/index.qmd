---
title: "Data sniffing"
author: 
  - "Fonti Kar"
  - "Emi Tanaka"
date: 2025/10/21
institute: 
  - ""
  - Australian National University
knitr: true
execute:
  cache: true
format: 
  anu-light-revealjs:
    width: 1920
    height: 1080
    disable-layout: false
    auto-stretch: false
    html-math-method: katex
    css: [/assets/tachyons-addon.css]
editor_options: 
  chunk_output_type: console
---

## What do you look for in a [good apple]{.highlight}?

```{r setup}
#| include: false
# R packages
library(here)
library(readxl)
library(janitor)
library(tidyverse)
library(kableExtra)
```

```{css}
.red {
  color: #B1001C;
}
.highlight {
  background-color: #F0EDCC;
  padding: 7px;
  color: #02343F;
  font-weight: bold;
  transform: skew(-7deg);
  display: inline-block;
}

.box {
  background-color: #F0EDCC;
  color: #02343F;
  padding: 20px;
  border-radius: 20px;
  margin-bottom: 7px;
}
.box p:first-child {
  margin: 0!important;
  display: block;
  margin-bottom: 20px!important;
}

.box P:first-child > strong {
  background-color: #02343F;
  color: #F0EDCC;
  width: 100%;
  padding: 20px;
}

.reveal pre.sourceCode code {
  /* height: 500px; */
  max-height: 1000px;
}

```

- colour?
- scent? 
- firmness? 

![](images/apples.jpeg)

## How about for [data]{.highlight}?


well, that depends on your research question...

but there are some sniff tests you should do!

In practice, this is more formally known as [initial data analysis]{.highlight}

![](images/apples.jpeg)

## Data Analysis 


- **Data analysis** is a process of cleaning, transforming, inspecting and modelling data with the aim of addressing a question. 

. . . 


::: {.columns}
::: {.column width="50%"}

::: box

**Exploratory data analysis**

- Flexible, iterative, visual for discovering, identifying, or formulating hypothesis.

:::



:::

::: {.column width="50%"}

::: box

**Confirmatory data analysis**

- Structured, rigorous, statistical for testing, assessing, or concluding.

:::


:::
:::


::: aside 

 _"EDA is an attitude, a flexibility, and a reliance on display, NOT a bundle of techniques." -- Tukey (1980)_

Tukey, J. W. (1980) We Need Both Exploratory and Confirmatory. _The American Statistician_.

:::


## Initial Data Analysis


- **Data analysis** is a process of cleaning, transforming, inspecting and modelling data with the aim of addressing a question. 

. . . 

::: {.columns}
::: {.column width="60%"}

::: box

**Initial data analysis**
  
- Inspecting, checking and exploration of data to ensure quality and understand data structure.

  
:::

:::

::: {.column width="40%"}

::: box

**Confirmatory data analysis**

- Structured, rigorous, statistical for testing, assessing, or concluding.
  
:::
:::

:::

::: aside 

- Chatfield (1985) The Initial Examination of Data. _Journal of the Royal Statistical Society. Series A (General)_
- Cox & Snell (1981) Applied Statistics. London: Chapman and Hall.
- Rao (1983) Optimum balance between statistical theory and application in teaching. _Proc. of the First Int Conference on Teaching Statistics_


::: 
  

## Analysis framework

::: {.columns}
::: {.column width="70%"}

![](images/ida-framework-simplified.png){width=200%}

:::

::: {.column width="30%" .f2}


::: box

**Tidy data**

1. Each column is a variable.
2. Each row is an observation.
3. Each cell is a single value.

:::

:::
:::





::: {.aside}

::: f3

- Huebner et al (2016) A systematic approach to initial data analysis is good research practice.<br> _The Journal of Thoracic and Cardiovascular Surgery_
- Huebner et al (2018) A Contemporary Conceptual Framework for Initial Data Analysis. _Observational Studies_
- Steegen et al (2016) Increasing Transparency Through a Multiverse Analysis. _Perspect Psychol Sci_
- van der Loo & de Jonge (2018) Statistical Data Cleaning with Applications in R.
- Wickham (2014) Tidy Data. _Journal of Statistical Software_

:::



::: 



## Grains Trade Australia x ZoomAgri

::: {.columns}
::: {.column width="50%"}

![](images/gta-logo.png)

![](images/gta-silos.png){width=70%}

::: box
  
- Long term storage of harvest from multiple farmers
- Need solution to identify / verify grains
:::

:::

::: {.column width="50%"}

![](images/zoomagri-logo.jpeg)

![](images/zoomagri-device.jpg)

::: box
  
- Computer vision / machine learning tech to identify and grade agri commodities
- Device trained for 7* varieties

:::


:::

:::

## Grains Trade Australia x ZoomAgri üåæü§ñ


::: {.columns}
::: {.column width="50%"}

![](images/gta-logo.png)

![](images/gta-silos.png){width=70%}


:::

::: {.column width="50%"}

![](images/zoomagri-logo.jpeg)

![](images/zoomagri-device.jpg)


:::

:::

. . . 

::: box

<b>üéØ **What is the efficacy of the ZoomAgri devices in detecting the correct barley varietal(s)?**</b>

:::



## Grains Trade Australia x ZoomAgri üåæü§ñ

::: box

<b>üéØ **What is the efficacy of the ZoomAgri devices in detecting the correct barley varietal(s)?**</b>

:::

::: incremental

We were given: 

- an Excel [data]() file
- A [report]() prepared by ZoomAgri describing their in-house methods and analysis

::: 

Be skeptical, _very skeptical_ üßê


## ZoomAgri methods ü§ñ

- 10 devices
- 7 barley varietals
- 24 samples
  - 12 pure samples (single variety)
  - 12 admixed samples (two varieties in different proportions)

::: {.columns}
::: {.column width="50%"}

![](images/samples-pure.png)


:::

::: {.column width="50%"}

![](images/samples-admix.png)

:::

:::

## Get the lay of the land üëÄ

![](images/data-excel-quick-look.mp4){width=150%}

## Get the lay of the land üëÄ


```{r}
#| code-fold: true
#| echo: true
# Data
raw_data <- read_excel(here("data/data-raw/Copy of GTA Assesment Protocol Test_Zoomagri_ShrdMrsdn.xlsx"), sheet = "Clean") |> 
  clean_names() |> # Turn all column names to lower, snakecase
  rename(result_1_percent = percent_12, # Give percent results a more relevant name
         result_2_percent = percent_14,
         result_3_percent = percent_16)
  

# Not sure how to fit this table nicely
raw_data |> 
  select(workstation, sample_code,result_1:result_3) |> 
  kable()
```

::: incremental
- `workstation` = "Device"
- Device gives up to 3 results
- "Others" is always in the results 3, less often in results 2
::: 

## If in doubt, count it out

```{r}
raw_data |> 
  count(workstation)

raw_data |> 
  count(sample_code) 
```

::: incremental
What we learned:

- Identified some missing values (`NA`) in `workstation` and `sample_code`
- See how data is encoded
    - `GTAPure` prefix for pure samples
    - `GTAMix` prefix for admixed samples
- Found interesting values e.g. `GTAPure10 - Repeat1,2,3`, `GTABottler`, `GTACyclops`

Analysis plan:

- Excluding missing values
- Handle interesting values 
    - Exclude `GTABottler`, `GTACyclops`
    - Exclude `Mino - not done` 
    - Consolidate `GTAPure10 - Repeat1,2,3`
::: 

## Drop dead weight: constant values and redundancy

Variables that are not contributing any information: 
  - Share same values as another variable
  - Have a constant value
  - Not relevant to key question e.g. dates

```{r}
raw_data_precursory_clean |> 
  janitor::get_one_to_one() 

raw_data |> 
  janitor::remove_constant()

raw_data_precursory_clean |> 
  select(-c(pc_id, s_n, ends_with("date")))
```

## Cursory clean from IDA

```{r}
raw_data_cursory_clean <- raw_data |> 
  drop_na(workstation, sample_code) |>
  filter(str_detect(sample_code, "Mix|Pure")) |> 
  mutate(sample_code = 
           case_when(
             str_detect(sample_code, "Repeat") ~ "GTAPure10",
             .default = sample_code
                      ),
         ) |> 
  janitor::remove_constant() |> 
  select(-c(pc_id, s_n, ends_with("date")))
```

## Don't be afraid to go digging üïµÔ∏è

What is `classified_seeds`? 

{{< video https://youtu.be/25KTTGTr08o >}}

::: incremental
What we learned:

- An unknown amount of seeds are added to the device
- Some seeds are deemed inadequate by the machine and are "discarded" 
- The remaining seeds are recorded as `classified_seeds`
- Number of seeds is an easier variable to use compared to percentages/proportions
::: 

## 

## Make it tidy

Humans like to record data in a "wide" format, R likes to work with data long format

```{r}
gta_tidy <- raw_data_cursory_clean |> 
  mutate(obs_id = 1:n()) |> 
  pivot_longer(cols = c(result_1, result_2, result_3),
               values_to = "variety",
               names_to = "result") |> 
  pivot_longer(cols = starts_with("result_"),
               names_to = "result_percent",
               values_to = "percent") |> 
  filter(result == str_remove(result_percent, "_percent")) |> 
  mutate(result_top = str_remove(result, "result_")) |> 
  select(-result, -result_percent)  |> 
  filter(!is.na(variety))

gta_tidy
```

```{r}
# add varieties with zero percent -------------------------------------------------
varieties <- c("Planet", "Spartacus CL", "Westminster", "Bass", "Maximus CL", 
               "La Trobe", "Commodus CL")
varieties_zero <- expand_grid(variety = varieties, percent = 0, obs_id = unique(gta_tidy$obs_id))

missing_zeroes <- varieties_zero |> 
  anti_join(select(gta_tidy, variety, percent, starts_with("result"), obs_id), by = c("obs_id", "variety"))

input <- bind_rows(gta_tidy, missing_zeroes) |> 
  arrange(obs_id) |> 
  fill(-result_top)
```




::: aside
Cite Tidy data
:::


## Seeing is believing: IDA with data visualisations

**Histograms by sample**

```{r}

```



## Data Description {.scrollable}

::: box

<b>üéØ Aim to assess the structure and quality of the data</b>

:::

- A non-exhaustive list of things to check could include:
  - Studying the **missing data** patterns 
  - **Numerical or graphical summaries** of univariate and multivariate distributions
    - Does the distribution of the data imply violations of assumptions for the main analysis?
    - Checking if data collection method is consistent across discrete set of variables
    - Plotting the data entry order across variables 
  - Identifying the **observational unit**
  - If a comparative experiment, 
    - Identify the **experimental unit** for every treatment factor
    - Be aware of **pseudo-replicates**!
    - Does the treatment group have different demographic characteristics to the control group?
    - Does the experimental layout match the description match? 
    - In particular, are treatments randomised?



## Sanity check your data 

::: incremental

- Also referred to as [**_data scrutinizing_**]{.highlight}.
- Use common or domain knowledge to [**_check if the recorded data have sensible values_**]{.highlight}. 
- For example:
  - Are positive values, e.g. height and weight, recorded as positive values with a plausible range?
  - If the data are counts, do the recorded values contain non-integer values?
  - For compositional data, do the values add up to 100% (or 1)? If not is that a measurement error or due to rounding? Or is another variable missing?
  - Are data encoded correctly?
- [**_Use independent or external sources_**]{.highlight} (quick Google or past published articles)
- Consider if or how [**_data were derived_**]{.highlight}

:::


